# Amplify MuleSoft AnyPoint Discovery Agent

## Prerequisites

Install the agent and provision Amplify Central access as described in the [README](/README.md).

## Executing

The MuleSoft AnyPoint Discovery Agent is built and distributed as a docker image. To execute the agent using the image, the following command may be executed. Update the version in the examples below.

```shell
docker run --env-file env_vars -v `pwd`/keys:/keys ghcr.io/axway/mulesoft_discovery_agent:v1.2.2
```

## Configuration Variables

Along with all [common agent variables](https://docs.axway.com/bundle/amplify-central/page/docs/connect_manage_environ/connected_agent_common_reference/agent-variables/index.html) the discovery agent also supports the following settings

| Variable Name                   | YAML Path                       | Description                                                                                                                                                                                                                                                                                  | **Location** / _Default_                                                                                                                                                          |
| ------------------------------- | ------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| MULESOFT_ANYPOINTEXCHANGEURL    | mulesoft.anypointExchangeUrl    | Mulesoft Anypoint Exchange URL                                                                                                                                                                                                                                                               | <https://anypoint.mulesoft.com>                                                                                                                                                   |
| MULESOFT_AUTH_LIFETIME          | mulesoft.auth.lifetime          | The session lifetime. The agent will automatically refresh the access token as it approaches the end of its lifetime                                                                                                                                                                         | 60m                                                                                                                                                                               |
| MULESOFT_AUTH_PASSWORD          | mulesoft.auth.password          | The password for the Mulesoft Anypoint username created for this agent                                                                                                                                                                                                                       |                                                                                                                                                                                   |
| MULESOFT_AUTH_USERNAME          | mulesoft.auth.username          | The Mulesoft Anypoint username created for this agent                                                                                                                                                                                                                                        |                                                                                                                                                                                   |
| MULESOFT_AUTH_CLIENTID          | mulesoft.auth.clientID          | The client id of a defined  connected app with all of the necessary permssions                                                                                                                                                                                                               |                                                                                                                                                                                   |
| MULESOFT_AUTH_CLIENTSECRET      | mulesoft.auth.clientSecret      | The client secret of a defined  connected app with all of the necessary permssions                                                                                                                                                                                                           |                                                                                                                                                                                   |
| MULESOFT_CACHEPATH              | mulesoft.cachePath              | Path entry to store stateful cache between agent invocations                                                                                                                                                                                                                                 | _/tmp_                                                                                                                                                                            |
| MULESOFT_DISCOVERYIGNORETAGS    | mulesoft.discoveryIgnoreTags    | Comma-separated black list of tags that, if any are present, will prevent an API being publised to Amplify Central. Take precedence over MULESOFT_DISCOVERYTAGS                                                                                                                              | (empty tag list)                                                                                                                                                                  |
| MULESOFT_DISCOVERYTAGS          | mulesoft.discoveryTags          | Comma-separated list of tags that, if any are present, will allow an API to be publised to Amplify Central. All APIs are discovered if not tags are specified                                                                                                                                | (empty tag list)                                                                                                                                                                  |
| MULESOFT_DISCOVERORIGINALRAML   | mulesoft.discoverOriginalRAML   | Set to true if the agent should discover the Assets that were created in RAML as RAML                                                                                                                                                                                                        | _false_                                                                                                                                                                           |
| MULESOFT_ENVIRONMENT            | mulesoft.environment            | The Mulesoft Anypoint Exchange the agent connects to, e.g. Sandbox.                                                                                                                                                                                                                          |                                                                                                                                                                                   |
| MULESOFT_ORGNAME                | mulesoft.orgName                | The Mulesoft Anypoint Business Unit the agent connects to                                                                                                                                                                                                                                    |                                                                                                                                                                                   |
| MULESOFT_POLLINTERVAL           | mulesoft.pollInterval           | The frequency in which Mulesoft API Manager is polled for new endpoints.                                                                                                                                                                                                                     | _30s_                                                                                                                                                                             |
| MULESOFT_PROXYURL               | mulesoft.proxyUrl               | The url for the proxy for API Manager (e.g. <http://username:password@hostname:port>). If empty, no proxy is defined.                                                                                                                                                                        | Internally, this value defaults to empty                                                                                                                                          |
| MULESOFT_SSL_CIPHERSUITES       | mulesoft.ssl.cipherSuites       | An array of strings. It is a list of supported cipher suites for TLS versions up to TLS 1.2. If CipherSuites is nil, a default list of secure cipher suites is used, with a preference order based on hardware performance.                                                                  | [See](https://docs.axway.com/bundle/amplify-central/page/docs/connect_manage_environ/connected_agent_common_reference/agent_security/index.html) for default cipher suite setting |
| MULESOFT_SSL_INSECURESKIPVERIFY | mulesoft.ssl.insecureSkipVerify | InsecureSkipVerify controls whether a client verifies the server's certificate chain and host name. If InsecureSkipVerify is true, TLS accepts any certificate presented by the server and any host name in that certificate. In this mode, TLS is susceptible to man-in-the-middle attacks. | Internally defaulted to false                                                                                                                                                     |
| MULESOFT_SSL_MAXVERSION         | mulesoft.ssl.maxVersion         | String value for the maximum SSL/TLS version that is acceptable. If empty, then the maximum version supported by this package is used, which is currently TLS 1.3. Allowed values are: TLS1.0, TLS1.1, TLS1.2, TLS1.3                                                                        | Internally, this value defaults to empty                                                                                                                                          |
| MULESOFT_SSL_MINVERSION         | mulesoft.ssl.minVersion         | String value for the minimum SSL/TLS version that is acceptable. If zero, empty TLS 1.0 is taken as the minimum. Allowed values are: TLS1.0, TLS1.1, TLS1.2, TLS1.3                                                                                                                          | Internally, the value defaults toTLS1.2                                                                                                                                           |
| MULESOFT_SSL_NEXTPROTOS         | mulesoft.ssl.nestProtos         | An array of strings. It is a list of supported application level protocols, in order of preference, based on the ALPN protocol list. Allowed values are: h2, htp/1.0, http/1.1, h2c                                                                                                          | Internally empty. Default negotiation.                                                                                                                                            |